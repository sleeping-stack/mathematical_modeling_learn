# 层次分析法（AHP）

## 模型思想

- 评价：需考虑评价指标及其对应的权重。
- 层次分析法概念：

## 求解步骤

1. **确定目标层、准则层、方案层**

   例如：
   - **目标层**：购买手机  
   - **准则层**：性能跑分、拍照像素、充电速度、电池续航  
   - **方案层**：小米、华为、苹果  

2. **数据处理、消除量纲（若存在原始数据）**

   原始数据示例：

   | 手机 | 性能跑分 | 拍照像素 | 电池续航 | 充电速度 |
   | ---- | -------- | -------- | -------- | -------- |
   | 小米 | 81W      | 48MP     | 9h       | 67W      |
   | 华为 | 70W      | 50MP     | 12h      | 66W      |
   | 苹果 | 100W     | 12MP     | 10h      | 20W      |

   归一化公式（按列归一化）：
   $$
   X_{ij} = \frac{x_{ij}}{\sum_{i = 1}^n x_{ij}}
   $$

3. **构建判断矩阵（用于确定指标权重）**

   - 使用 **1–9 标度法** 进行两两比较：

     | 标度    | 含义                         |
     | ------- | ---------------------------- |
     | 1       | 两个因素相比，具有相同重要性 |
     | 3       | 前者比后者稍重要             |
     | 5       | 前者比后者明显重要           |
     | 7       | 前者比后者强烈重要           |
     | 9       | 前者比后者极端重要           |
     | 2,4,6,8 | 上述相邻判断的中间值         |

   - 示例判断矩阵（准则层）：

     |          | 性能跑分 | 拍照像素 | 充电速度 | 电池续航 |
     | -------- | -------- | -------- | -------- | -------- |
     | 性能跑分 | 1        | 5        | 3        | 2        |
     | 拍照像素 | 1/5      | 1        | 2        | 1/3      |
     | 充电速度 | 1/3      | 1/2      | 1        | 2        |
     | 电池续航 | 1/2      | 3        | 1/2      | 1        |

   - 正互反矩阵性质：
     - $ a_{ii} = 1 $
     - $ a_{ij} = \frac{1}{a_{ji}} $
     - 若满足一致性，则 $a_{ij} = a_{ik} \cdot a_{kj}$

4. **计算权重（三种方法）**  

- 概念
	- 矩阵特征值：对于给定矩阵 $A$，寻找一个常数 $\lambda$ 和非零向量 $x$，使得向量 $x$ 被矩阵 $A$ 作用后所得的向量 $Ax$ 与原向量 $x$ 平行，并且满足 $Ax = \lambda x$。
	- 一致性矩阵计算特征值
    $$
    a_{ij} = \frac{i \text{ 的重要程度}}{j \text{ 的重要程度}}\\
    a_{kj} = \frac{k \text{ 的重要程度}}{j \text{ 的重要程度}}\\
    a_{ij} = \frac{i}{k} a_{kj}
    $$
	- $A$ 为 $ n $ 阶方阵，且 $r(A) = 1$，则 $A$ 有一个特征值为 $tr(A)$，其余特征值均为 $0$。
  
	- $ n $ 阶正互反矩阵 $A$ 为一致矩阵时当且仅当最大特征值 $\lambda_{max} = n$。且当正互反矩阵 $A$ 非一致时，一定满足 $\lambda_{max} > n$，判断矩阵越不一致时，最大特征值与 $ n $ 相差就越大。
	
- 算术平均法
   - 对判断矩阵按列归一化；
   - 将每行归一化后的值求平均，即得权重。

     $$
     w_i = \frac{1}{n} \sum_{j=1}^{n} \frac{a_{ij}}{\sum_{k=1}^{n} a_{kj}}
     $$

- 几何平均法

   - 每行元素相乘：$ P_i = \prod_{j=1}^{n} a_{ij} $
   - 开 $ n $ 次方：$ G_i = P_i^{1/n} $
   - 归一化：$ w_i = \frac{G_i}{\sum_{k=1}^{n} G_k} $

- 特征值法（推荐）

   - 计算判断矩阵的最大特征值 $ \lambda_{\max} $ 及其对应的特征向量；
   - 对特征向量归一化，即得权重向量。

5. **一致性检验**

   - 一致性指标（$CI$）：
     $$
     CI = \frac{\lambda_{\max} - n}{n - 1}
     $$

   - 随机一致性指标（$RI$）查表：

     | n    | 1    | 2    | 3    | 4    | 5    | 6    | 7    | 8    | 9    |
     | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
     | RI   | 0    | 0    | 0.58 | 0.90 | 1.12 | 1.24 | 1.32 | 1.41 | 1.45 |

> $RI$构造：随机构造大量样本矩阵，随机地从1～9及其倒数中抽取数字构造正互反矩阵，求得最大特征值的平均值$\lambda_{\max}^{'}$

   - 一致性比例（$CR$）：
     $$
     CR = \frac{CI}{RI}
     $$

   - 判定标准：
     
     - 若 $CR = 0$：为一致矩阵；
     - 若 $CR < 0.1$：通过一致性检验，权重有效；
     - 否则需重新调整判断矩阵。
     

6. **综合评分计算**

   - 若有原始数据（如性能跑分等），先归一化各方案在各指标下的得分；
   - 综合得分公式：
     $$
     \text{综合评分} = \sum_{i=1}^{m} (\text{指标}_i \text{得分}) \times (\text{指标}_i \text{权重})
     $$

   - 最终选择综合得分最高的方案。
